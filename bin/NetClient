#!/usr/bin/perl

use Daemon::Daemonize qw/ :all /;
use IO::Socket::INET;
use File::Tail;
use threads;
use YAML::Tiny;
use Data::Dumper;
use Logger::Logger;
use FindBin;

use lib "$FindBin::Bin/../lib";

use Main;


my $pidfile = "/var/run/NetClient.pid";
my ($socket,$client_socket);
my @threads; #threads array

#TODO
if ( Main::start_proc() eq 0 ) {
	$logger->debug_message("StartUP process result: " . Main::start_proc());
	exit 1;
}

$logger->debug_message("StartUP process result: " . Main::start_proc());

Daemon::Daemonize->daemonize;
write_pidfile( $pidfile );

#my $threads = scalar( keys $config->[0]); #max threads count

@logs = get_logs_from_config();

for ($i =$[; $i <= $#logs; $i++)
{
        $t = threads->new(\&send_read_log, $logs[$i]);
        push @threads, $t;
}

foreach(threads->list) {
        $_->join();
}


$socket->close();
